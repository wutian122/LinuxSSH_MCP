# 项目使用文档（SSH-MCP-001）

## 1. 启动方式

推荐在项目目录启动：

```powershell
.\.venv\Scripts\python main.py
```

也可：

```powershell
.\.venv\Scripts\python -m linux_ssh_mcp
```

## 2. Claude Desktop 配置示例（stdio）

以下为示例结构（按你的 Claude Desktop 配置文件格式调整）。关键点是：command 指向 python.exe，args 指向项目入口。

```json
{
  "mcpServers": {
    "linux-ssh-mcp": {
      "command": "E:\\code\\python-use\\项目\\LinuxSSH_MCP远程命令执行工具\\.venv\\Scripts\\python.exe",
      "args": [
        "E:\\code\\python-use\\项目\\LinuxSSH_MCP远程命令执行工具\\main.py"
      ]
    }
  }
}
```

如果客户端对路径中的空格处理不正确，建议使用 8.3 短路径（示例需按你的机器实际短路径替换）：

```json
{
  "mcpServers": {
    "linux-ssh-mcp": {
      "command": "E:\\code\\PYTHON~1\\项目\\LINUXS~1\\.venv\\Scripts\\python.exe",
      "args": ["-m", "linux_ssh_mcp"]
    }
  }
}
```

如果你更偏好模块方式：

```json
{
  "mcpServers": {
    "linux-ssh-mcp": {
      "command": "E:\\code\\python-use\\项目\\LinuxSSH_MCP远程命令执行工具\\.venv\\Scripts\\python.exe",
      "args": ["-m", "linux_ssh_mcp"]
    }
  }
}
```

## 3. Cherry Studio 配置建议

- 选择 MCP（stdio）模式
- 命令：指向本项目 .venv 的 python.exe
- 参数：main.py 的绝对路径，或使用 -m linux_ssh_mcp

## 4. 凭据使用策略

- 每个工具调用都支持通过参数直接传入：password / private_key_path
- 若不传入，则从 keyring 读取（需要先调用 `auth_store_credentials` 进行写入）

## 5. 工具清单与参数

### 5.1 auth_store_credentials

- 用途：保存凭据到 keyring
- 参数：host, username, password?, private_key_path?

### 5.2 ssh_execute

- 用途：执行单条命令
- 参数：host, username, command, port=22, password?, private_key_path?
- 输出控制：token_mode=full|filter|truncate, filter_pattern?, max_tokens?
- 缓存：use_cache, cache_category=static|dynamic, cache_ttl_seconds?

### 5.3 ssh_execute_batch

- 用途：同一连接内顺序执行多条命令
- 参数：host, username, commands[], port=22, password?, private_key_path?

### 5.4 ssh_execute_script

- 用途：stdin 传入脚本执行（bash -s）
- 参数：host, username, script, shell=/bin/bash, port=22, password?, private_key_path?

### 5.5 ssh_system_info

- 用途：获取系统信息（强缓存 static）
- 参数：host, username, force_refresh=false

### 5.6 ssh_session_info

- 用途：查看当前缓存状态

### 5.7 ssh_search_content

- 用途：远端 grep 搜索
- 参数：host, username, query, path, token_mode=truncate, max_tokens=800

### 5.8 ssh_clear_cache

- 用途：清理缓存
- 参数：keys?, tag?, category?

### 5.9 ssh_health_check

- 用途：快速连通性检查（echo ok）
- 参数：host, username

### 5.10 file_upload

- 用途：上传文件（SFTP + 分块 + 可选MD5）
- 参数：host, username, local_path, remote_path, verify_md5=true, chunk_size=8192, resume=false

### 5.11 file_download

- 用途：下载文件（SFTP + 分块 + 可选MD5）
- 参数：host, username, remote_path, local_path, verify_md5=true, chunk_size=8192, resume=false

### 5.12 file_info

- 用途：获取远端文件信息
- 参数：host, username, path

### 5.13 dir_list

- 用途：目录列表（分页 + 过滤）
- 参数：host, username, path, page=1, page_size=100, filter_pattern?

### 5.14 dir_interactive

- 用途：交互式会话（复用 session_id）
- 参数：host, username, command, session_id?, close_session=false

## 6. 常见问题

1. keyring 无法保存/读取
   - 请确认系统允许 keyring 使用，或在无 UI 环境下改用直接参数传入凭据。

2. 远端没有 md5sum
   - 当前实现依赖 md5sum（常见 Linux 默认具备）。若目标机缺失，可在后续增强为 md5/openssl 等兜底。
